<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>Atbash Cipher Code Refactoring Record</title>

    <!-- Open Graph Meta -->
    <meta content="Go deep" property="og:site_name"><meta content="Atbash Cipher Code Refactoring Record" property="og:title"><meta content="article" property="og:type"><meta content="Go deep and be professional" property="og:description"><meta content="https://godeep.pro/blog/atbash-cipher-code-refactoring-record/" property="og:url"><meta content="2019-12-28T00:00:00+00:00" property="article:published_time">
      <meta content="https://godeep.pro/about/" property="article:author"><meta content="https://godeep.pro/assets/img/touring.jpg" property="og:image"><!-- Twitter Cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@brianmaierjr">
    <meta name="twitter:creator" content="@brianmaierjr"><meta name="twitter:title" content="Atbash Cipher Code Refactoring Record"><meta name="twitter:url" content="https://godeep.pro/blog/atbash-cipher-code-refactoring-record/"><meta name="twitter:description" content="Go deep and be professional"><meta name="twitter:image:src" content="https://godeep.pro/assets/img/touring.jpg"><!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico" />

    <!-- Come and get me RSS readers -->
    <link rel="alternate" type="application/rss+xml" title="Go deep" href="https://godeep.pro/feed.xml" />
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/mo.css">
    <!--[if IE 8]><link rel="stylesheet" href="/assets/css/ie.css"><![endif]-->
    <link rel="canonical" href="https://godeep.pro/blog/atbash-cipher-code-refactoring-record/">

    <!-- Modernizr -->
    <script src="/assets/js/modernizr.custom.15390.js"" type="text/javascript"></script><!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-G-ZRGHXLDL9E', 'auto');
ga('send', 'pageview');

</script>
</head>
<body> <div class="header ">
     <div class="container">
         <h1 class="logo"><a href="/">Go deep</a></h1>
         <nav class="nav-collapse">
             <ul class="noList"><li class="elementfirst">
                     <a href="/index.html">Home</a>
                 </li><li class="element">
                     <a href="/articles">Articles (English)</a>
                 </li><li class="element">
                     <a href="/articles-zh">Articles (中文)</a>
                 </li><li class="element">
                     <a href="/articles-jp">Articles (日本語)</a>
                 </li><li class="element">
                     <a href="/categories">Categories</a>
                 </li><li class="element">
                     <a href="/contact">Contact</a>
                 </li><li class="elementlast">
                     <a href="/about">About</a>
                 </li><li> <a href="https://github.com/gabirel" target="_blank">GitHub</a></li>
             </ul>
         </nav>
     </div>
 </div><!-- end .header -->
<div class="content">
      <div class="container">
         <article class="post"><header>
    <h1 class="postTitle">Atbash Cipher Code Refactoring Record</h1>
    
    <p class="meta">December 28, 2019 | <span class="time">12</span> Minutes Read</p>
    
  </header>

  <p class="intro"><span class="dropcap">T</span>This comes from the main exercise of exercism in rust. I asked some friends from a small Rust community and I got these elegant codes. These codes are so beautiful and tricky. So I decide to write it down and hope it may be useful for you as well.</p>

<p>You may learn how to “chunk” vector in rust as a string without using a loop while joining characters.</p>

<hr />
<p>Table of Contents</p>

<ul id="markdown-toc">
  <li><a href="#instructions" id="markdown-toc-instructions">Instructions</a></li>
  <li><a href="#test-suite" id="markdown-toc-test-suite">Test suite</a></li>
  <li><a href="#solution" id="markdown-toc-solution">Solution</a>    <ul>
      <li><a href="#version-1" id="markdown-toc-version-1">Version 1</a></li>
      <li><a href="#version-2" id="markdown-toc-version-2">Version 2</a></li>
      <li><a href="#version-3" id="markdown-toc-version-3">Version 3</a></li>
      <li><a href="#version-4" id="markdown-toc-version-4">Version 4</a></li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="instructions">Instructions</h1>

<p>Create an implementation of the atbash cipher, an ancient encryption system created in the Middle East.</p>

<p>The Atbash cipher is a simple substitution cipher that relies on transposing all the letters in the alphabet such that the resulting alphabet is backwards. The first letter is replaced with the last letter, the second with the second-last, and so on.</p>

<p>An Atbash cipher for the Latin alphabet would be as follows:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Plain:  abcdefghijklmnopqrstuvwxyz
Cipher: zyxwvutsrqponmlkjihgfedcba
</code></pre></div></div>
<p>It is a very weak cipher because it only has one possible key, and it is a simple monoalphabetic substitution cipher. However, this may not have been an issue in the cipher’s time.</p>

<p>Ciphertext is written out in groups of fixed length, the traditional group size being 5 letters, and punctuation is excluded. This is to make it harder to guess things based on word boundaries.</p>

<p>Examples</p>
<ul>
  <li>Encoding <code class="language-plaintext highlighter-rouge">test</code> gives <code class="language-plaintext highlighter-rouge">gvhg</code></li>
  <li>Decoding <code class="language-plaintext highlighter-rouge">gvhg</code> gives <code class="language-plaintext highlighter-rouge">test</code></li>
  <li>Decoding <code class="language-plaintext highlighter-rouge">gsvjf rxpyi ldmul cqfnk hlevi gsvoz abwlt</code> gives <code class="language-plaintext highlighter-rouge">thequickbrownfoxjumpsoverthelazydog</code></li>
</ul>

<h1 id="test-suite">Test suite</h1>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="n">atbash_cipher</span> <span class="k">as</span> <span class="n">cipher</span><span class="p">;</span>

<span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">test_encode_yes</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"yes"</span><span class="p">),</span> <span class="s">"bvh"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_encode_no</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"no"</span><span class="p">),</span> <span class="s">"ml"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_encode_omg</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"OMG"</span><span class="p">),</span> <span class="s">"lnt"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_encode_spaces</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"O M G"</span><span class="p">),</span> <span class="s">"lnt"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_encode_mindblowingly</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"mindblowingly"</span><span class="p">),</span> <span class="s">"nrmwy oldrm tob"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_encode_numbers</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span>
        <span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"Testing,1 2 3, testing."</span><span class="p">),</span>
        <span class="s">"gvhgr mt123 gvhgr mt"</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_encode_deep_thought</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"Truth is fiction."</span><span class="p">),</span> <span class="s">"gifgs rhurx grlm"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_encode_all_the_letters</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span>
        <span class="nn">cipher</span><span class="p">::</span><span class="nf">encode</span><span class="p">(</span><span class="s">"The quick brown fox jumps over the lazy dog."</span><span class="p">),</span>
        <span class="s">"gsvjf rxpyi ldmul cqfnk hlevi gsvoz abwlt"</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_decode_exercism</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">decode</span><span class="p">(</span><span class="s">"vcvix rhn"</span><span class="p">),</span> <span class="s">"exercism"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_decode_a_sentence</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span>
        <span class="nn">cipher</span><span class="p">::</span><span class="nf">decode</span><span class="p">(</span><span class="s">"zmlyh gzxov rhlug vmzhg vkkrm thglm v"</span><span class="p">),</span>
        <span class="s">"anobstacleisoftenasteppingstone"</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_decode_numbers</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">decode</span><span class="p">(</span><span class="s">"gvhgr mt123 gvhgr mt"</span><span class="p">),</span> <span class="s">"testing123testing"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_decode_all_the_letters</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span>
        <span class="nn">cipher</span><span class="p">::</span><span class="nf">decode</span><span class="p">(</span><span class="s">"gsvjf rxpyi ldmul cqfnk hlevi gsvoz abwlt"</span><span class="p">),</span>
        <span class="s">"thequickbrownfoxjumpsoverthelazydog"</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_decode_with_too_many_spaces</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">cipher</span><span class="p">::</span><span class="nf">decode</span><span class="p">(</span><span class="s">"vc vix    r hn"</span><span class="p">),</span> <span class="s">"exercism"</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">#[test]</span>
<span class="nd">#[ignore]</span>
<span class="k">fn</span> <span class="nf">test_decode_with_no_spaces</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span>
        <span class="nn">cipher</span><span class="p">::</span><span class="nf">decode</span><span class="p">(</span><span class="s">"zmlyhgzxovrhlugvmzhgvkkrmthglmv"</span><span class="p">),</span>
        <span class="s">"anobstacleisoftenasteppingstone"</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="solution">Solution</h1>

<h2 id="version-1">Version 1</h2>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">PLAIN</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="p">;</span>
<span class="k">const</span> <span class="n">CIPHER</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"zyxwvutsrqponmlkjihgfedcba"</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">atbash</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">text</span><span class="nf">.
        to_lowercase</span><span class="p">()</span><span class="nf">.
        chars</span><span class="p">()</span><span class="nf">.
        filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="nf">.is_ascii_alphabetic</span><span class="p">()</span> <span class="p">||</span> <span class="n">x</span><span class="nf">.is_ascii_digit</span><span class="p">())</span><span class="nf">.
        map</span><span class="p">(|</span><span class="n">f</span><span class="p">|</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">PLAIN</span><span class="nf">.find</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">PLAIN</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.nth</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Some</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
            <span class="p">}</span><span class="nf">.unwrap</span><span class="p">()</span>
        <span class="p">})</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;&gt;</span><span class="p">()</span>
<span class="p">}</span>

<span class="cd">/// "Encipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">encode</span><span class="p">(</span><span class="n">plain</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">tmp</span> <span class="o">=</span> <span class="nf">atbash</span><span class="p">(</span><span class="n">plain</span><span class="p">);</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">tmp</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">i</span><span class="nf">.rem_euclid</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">result</span><span class="nf">.push</span><span class="p">(</span><span class="sc">' '</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">result</span><span class="nf">.push</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">result</span>
<span class="p">}</span>

<span class="cd">/// "Decipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nf">atbash</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span><span class="nf">.into_iter</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">L11</code> uses <code class="language-plaintext highlighter-rouge">.rev()</code> feature to pin-point the index of <code class="language-plaintext highlighter-rouge">CIPHER</code> text. This is a little bit tricky.</p>

<p>In this version, I didn’t find any solutions to wrap pushing string into a <code class="language-plaintext highlighter-rouge">.map()</code>, which makes it look like C/C++-style and ugly since we need a loop to append <code class="language-plaintext highlighter-rouge">space</code> for me. This can be changed!</p>

<h2 id="version-2">Version 2</h2>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">PLAIN</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="p">;</span>
<span class="k">const</span> <span class="n">CIPHER</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"zyxwvutsrqponmlkjihgfedcba"</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">atbash</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">text</span>
        <span class="nf">.to_lowercase</span><span class="p">()</span>
        <span class="nf">.chars</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="nf">.is_ascii_alphabetic</span><span class="p">()</span> <span class="p">||</span> <span class="n">x</span><span class="nf">.is_ascii_digit</span><span class="p">())</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">f</span><span class="p">|</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">PLAIN</span><span class="nf">.find</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">PLAIN</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.nth</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Some</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
            <span class="p">}</span><span class="nf">.unwrap</span><span class="p">()</span>
        <span class="p">})</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;&gt;</span><span class="p">()</span>
<span class="p">}</span>

<span class="cd">/// "Encipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">encode</span><span class="p">(</span><span class="n">plain</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">tmp</span> <span class="o">=</span> <span class="nf">atbash</span><span class="p">(</span><span class="n">plain</span><span class="p">);</span>
    <span class="n">tmp</span>
        <span class="nf">.chunks</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="nf">.iter</span><span class="p">()</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">())</span>
        <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">()</span>
        <span class="nf">.join</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<span class="p">}</span>

<span class="cd">/// "Decipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nf">atbash</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span><span class="nf">.into_iter</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In version 2, I’ve made changes about wrapping encoded string. It happens at <code class="language-plaintext highlighter-rouge">L19~24</code>.</p>

<p>Explanation:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">L21</code> takes value for chunking vector as several slices(vector)</li>
  <li><code class="language-plaintext highlighter-rouge">L22</code> maps the chunked vector into <code class="language-plaintext highlighter-rouge">String</code></li>
  <li><code class="language-plaintext highlighter-rouge">L23</code> collects all data generated in step 2 together and outputs as <code class="language-plaintext highlighter-rouge">Vec&lt;String&gt;</code></li>
  <li><code class="language-plaintext highlighter-rouge">L24</code> use <code class="language-plaintext highlighter-rouge">.join()</code> method for joining item in <code class="language-plaintext highlighter-rouge">Vec&lt;String&gt;</code> with space and outputs the final result.</li>
</ol>

<p>So, basically, you don’t need a loop any more to add space after 5 characters. Removing loops in Rust is a kind of beautiful way of processing data.</p>

<h2 id="version-3">Version 3</h2>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">PLAIN</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="p">;</span>
<span class="k">const</span> <span class="n">CIPHER</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"zyxwvutsrqponmlkjihgfedcba"</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">atbash</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">text</span>
        <span class="nf">.to_lowercase</span><span class="p">()</span>
        <span class="nf">.chars</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="nf">.is_ascii_alphabetic</span><span class="p">()</span> <span class="p">||</span> <span class="n">x</span><span class="nf">.is_ascii_digit</span><span class="p">())</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">f</span><span class="p">|</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">PLAIN</span><span class="nf">.find</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">PLAIN</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.nth</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Some</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
            <span class="p">}</span><span class="nf">.unwrap</span><span class="p">()</span>
        <span class="p">})</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;&gt;</span><span class="p">()</span>
<span class="p">}</span>

<span class="cd">/// "Encipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">encode</span><span class="p">(</span><span class="n">plain</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">tmp</span> <span class="o">=</span> <span class="nf">atbash</span><span class="p">(</span><span class="n">plain</span><span class="p">);</span>
    <span class="n">tmp</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.enumerate</span><span class="p">()</span>
        <span class="nf">.flat_map</span><span class="p">(|(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)|</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">i</span><span class="nf">.rem_euclid</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nb">None</span>
            <span class="p">}</span><span class="nf">.into_iter</span><span class="p">()</span><span class="nf">.chain</span><span class="p">(</span><span class="nn">std</span><span class="p">::</span><span class="nn">iter</span><span class="p">::</span><span class="nf">once</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
        <span class="p">})</span>
        <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">()</span>
<span class="p">}</span>

<span class="cd">/// "Decipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nf">atbash</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span><span class="nf">.into_iter</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In version 3, in order to challenge memory usage, I’ve mainly removed one layer of <code class="language-plaintext highlighter-rouge">.collect()</code> since <code class="language-plaintext highlighter-rouge">.collect()</code> will consume heap memory usage which affects performance. So, I avoid using <code class="language-plaintext highlighter-rouge">.chunk()</code> and allocating memory on the heap again in <code class="language-plaintext highlighter-rouge">.map()</code> and replace it with the <code class="language-plaintext highlighter-rouge">iterator</code>. Why I choose <code class="language-plaintext highlighter-rouge">iterator</code> is that their lazily-evaluated nature, don’t allocate on the heap until explicitly told so (with <code class="language-plaintext highlighter-rouge">.collect()</code> for instance).</p>

<p>Also, <code class="language-plaintext highlighter-rouge">.enumerate()</code> yields pairs so we could use <code class="language-plaintext highlighter-rouge">.flat_map()</code> to remove the layer of iterator and collect them as <code class="language-plaintext highlighter-rouge">String</code> only once.</p>

<p>Saving memory allocation on the heap. Goal Achieved.</p>

<h2 id="version-4">Version 4</h2>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">PLAIN</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="p">;</span>
<span class="k">const</span> <span class="n">CIPHER</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"zyxwvutsrqponmlkjihgfedcba"</span><span class="p">;</span>

<span class="cd">/// return Iterator type: https://gist.github.com/conundrumer/4e57c14705055bb2deac1b9fde84f83b</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="n">atbash</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="nb">char</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nv">'a</span> <span class="p">{</span>
    <span class="n">text</span>
        <span class="nf">.chars</span><span class="p">()</span>
        <span class="nf">.flat_map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="nf">.to_lowercase</span><span class="p">())</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="nf">.is_ascii_alphabetic</span><span class="p">()</span> <span class="p">||</span> <span class="n">x</span><span class="nf">.is_ascii_digit</span><span class="p">())</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">f</span><span class="p">|</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">PLAIN</span><span class="nf">.find</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">PLAIN</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.nth</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
                <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nf">Some</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
            <span class="p">}</span><span class="nf">.unwrap</span><span class="p">()</span>
        <span class="p">})</span>
<span class="p">}</span>

<span class="cd">/// "Encipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">encode</span><span class="p">(</span><span class="n">plain</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">tmp</span> <span class="o">=</span> <span class="nf">atbash</span><span class="p">(</span><span class="n">plain</span><span class="p">);</span>
    <span class="n">tmp</span>
        <span class="nf">.enumerate</span><span class="p">()</span>
        <span class="nf">.flat_map</span><span class="p">(|(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)|</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">i</span><span class="nf">.rem_euclid</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nb">None</span>
            <span class="p">}</span><span class="nf">.into_iter</span><span class="p">()</span><span class="nf">.chain</span><span class="p">(</span><span class="nn">std</span><span class="p">::</span><span class="nn">iter</span><span class="p">::</span><span class="nf">once</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
        <span class="p">})</span>
        <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">()</span>
<span class="p">}</span>

<span class="cd">/// "Decipher" with the Atbash cipher.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nf">atbash</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In version 4, <code class="language-plaintext highlighter-rouge">atbash()</code> no longer returns <code class="language-plaintext highlighter-rouge">Vec&lt;char&gt;</code>, which avoids the memory allocation on the heap again.  But returning <code class="language-plaintext highlighter-rouge">Iterator</code> is a little bit tricky. You can find more examples in <a href="https://gist.github.com/conundrumer/4e57c14705055bb2deac1b9fde84f83b">here</a>.</p>

<p>Another change is that I move backward of <code class="language-plaintext highlighter-rouge">.to_lowercase()</code> and use <code class="language-plaintext highlighter-rouge">.flat_map()</code> instead since filtering all upprcase outside the function <code class="language-plaintext highlighter-rouge">atbash()</code> is not graceful and does not conform to the engineering.</p>

<p>So, basically in this version,  <code class="language-plaintext highlighter-rouge">.collect()</code>  operation is only used once. Memory allocation on the heap only happens once as well.</p>

<center><blockquote>The End</blockquote></center>


  <!-- POST NAVIGATION -->
  <footer class="postNav clearfix"><a class="prev" href="/blog/code-refactoring-of-bob-exercism-in-rust/"><span>&laquo;&nbsp;Code Refactoring of Bob - Exercism in Rust</span></a><a class="next" href="/blog/golang%E4%B8%ADTeeReader%E7%9A%84Writer%E8%BE%93%E5%87%BA%E4%B8%BA%E7%A9%BA%E7%9A%84%E9%97%AE%E9%A2%98%E5%B0%8F%E8%AE%B0/"><span>Golang 中 <coder>TeeReader</coder> 的 <coder>Writer</coder> 输出为空的问题小记&nbsp;&raquo;</span></a></footer>
</article>
      </div>
   </div><!-- end .content --><div class="footer">
	<div class="container">
		<p class="copy">
			&copy;2017-2022
					<a href="https://godeep.pro/about">Gabriel Farnsworth</a>.
				Powered by <a href="http://jekyllrb.com">Jekyll</a>.
			Theme by <a href="https://github.com/brianmaierjr/long-haul">Long-haul</a>.<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">Visits: <span id="busuanzi_value_site_pv"></span></span></p>

		<div class="footer-links">
			<ul class="noList"><li>
					<a href="https://github.com/gabirel" target="_blank">
						<svg id="github" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg"
							xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100"
							style="height: 30px; width: 30px;">
							<circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
							<path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)"
								d="M50,1C22.938,1,1,22.938,1,50s21.938,49,49,49s49-21.938,49-49S77.062,1,50,1z M79.099,79.099 c-3.782,3.782-8.184,6.75-13.083,8.823c-1.245,0.526-2.509,0.989-3.79,1.387v-7.344c0-3.86-1.324-6.699-3.972-8.517 c1.659-0.16,3.182-0.383,4.57-0.67c1.388-0.287,2.855-0.702,4.402-1.245c1.547-0.543,2.935-1.189,4.163-1.938 c1.228-0.75,2.409-1.723,3.541-2.919s2.082-2.552,2.847-4.067s1.372-3.334,1.818-5.455c0.446-2.121,0.67-4.458,0.67-7.01 c0-4.945-1.611-9.155-4.833-12.633c1.467-3.828,1.308-7.991-0.478-12.489l-1.197-0.143c-0.829-0.096-2.321,0.255-4.474,1.053 c-2.153,0.798-4.57,2.105-7.249,3.924c-3.797-1.053-7.736-1.579-11.82-1.579c-4.115,0-8.039,0.526-11.772,1.579 c-1.69-1.149-3.294-2.097-4.809-2.847c-1.515-0.75-2.727-1.26-3.637-1.532c-0.909-0.271-1.754-0.439-2.536-0.503 c-0.782-0.064-1.284-0.079-1.507-0.048c-0.223,0.031-0.383,0.064-0.478,0.096c-1.787,4.53-1.946,8.694-0.478,12.489 c-3.222,3.477-4.833,7.688-4.833,12.633c0,2.552,0.223,4.889,0.67,7.01c0.447,2.121,1.053,3.94,1.818,5.455 c0.765,1.515,1.715,2.871,2.847,4.067s2.313,2.169,3.541,2.919c1.228,0.751,2.616,1.396,4.163,1.938 c1.547,0.543,3.014,0.957,4.402,1.245c1.388,0.287,2.911,0.511,4.57,0.67c-2.616,1.787-3.924,4.626-3.924,8.517v7.487 c-1.445-0.43-2.869-0.938-4.268-1.53c-4.899-2.073-9.301-5.041-13.083-8.823c-3.782-3.782-6.75-8.184-8.823-13.083 C9.934,60.948,8.847,55.56,8.847,50s1.087-10.948,3.231-16.016c2.073-4.899,5.041-9.301,8.823-13.083s8.184-6.75,13.083-8.823 C39.052,9.934,44.44,8.847,50,8.847s10.948,1.087,16.016,3.231c4.9,2.073,9.301,5.041,13.083,8.823 c3.782,3.782,6.75,8.184,8.823,13.083c2.143,5.069,3.23,10.457,3.23,16.016s-1.087,10.948-3.231,16.016 C85.848,70.915,82.88,75.317,79.099,79.099L79.099,79.099z">
							</path>
						</svg>
					</a>
				</li><li>
					<a href="mailto:godeeppro@pm.me" target="_blank">
						<svg id="mail" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg"
							xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100"
							style="height: 30px; width: 30px;">
							<circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
							<path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)"
								d="M50,1C22.938,1,1,22.938,1,50s21.938,49,49,49s49-21.938,49-49S77.062,1,50,1z M25.5,25.5h49 c0.874,0,1.723,0.188,2.502,0.542L50,57.544L22.998,26.041C23.777,25.687,24.626,25.499,25.5,25.5L25.5,25.5z M19.375,68.375v-36.75 c0-0.128,0.005-0.256,0.014-0.383l17.96,20.953L19.587,69.958C19.448,69.447,19.376,68.916,19.375,68.375L19.375,68.375z M74.5,74.5 h-49c-0.541,0-1.072-0.073-1.583-0.212l17.429-17.429L50,66.956l8.653-10.096l17.429,17.429C75.572,74.427,75.041,74.5,74.5,74.5 L74.5,74.5z M80.625,68.375c0,0.541-0.073,1.072-0.211,1.583L62.652,52.195l17.96-20.953c0.008,0.127,0.014,0.255,0.014,0.383 L80.625,68.375L80.625,68.375z">
							</path>
						</svg>
					</a>
				</li></ul>
		</div>
	</div>
</div>
<!-- end .footer --><!-- Add jQuery and other scripts -->
<!-- seems to no need to load jquery from network -->
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
<script>window.jQuery || document.write('<script src="/assets/js/jquery-1.11.2.min.js"><\/script>')</script>
<script src="/assets/js/dropcap.min.js"></script>
<script src="/assets/js/responsive-nav.min.js"></script>
<script src="/assets/js/scripts.js"></script>
</body>

</html>
