<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>Constrain Struct Generic Field in Rust</title>

    <!-- Open Graph Meta -->
    <meta content="Go deep" property="og:site_name"><meta content="Constrain Struct Generic Field in Rust" property="og:title"><meta content="article" property="og:type"><meta content="Go deep and be professional" property="og:description"><meta content="https://godeep.pro/blog/constrain-struct-generic-field-in-rust/" property="og:url"><meta content="2022-05-19T00:00:00+00:00" property="article:published_time">
      <meta content="https://godeep.pro/about/" property="article:author"><meta content="https://godeep.pro/assets/img/touring.jpg" property="og:image"><!-- Twitter Cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@brianmaierjr">
    <meta name="twitter:creator" content="@brianmaierjr"><meta name="twitter:title" content="Constrain Struct Generic Field in Rust"><meta name="twitter:url" content="https://godeep.pro/blog/constrain-struct-generic-field-in-rust/"><meta name="twitter:description" content="Go deep and be professional"><meta name="twitter:image:src" content="https://godeep.pro/assets/img/touring.jpg"><!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico" />

    <!-- Come and get me RSS readers -->
    <link rel="alternate" type="application/rss+xml" title="Go deep" href="https://godeep.pro/feed.xml" />
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/mo.css">
    <!--[if IE 8]><link rel="stylesheet" href="/assets/css/ie.css"><![endif]-->
    <link rel="canonical" href="https://godeep.pro/blog/constrain-struct-generic-field-in-rust/">

    <!-- Modernizr -->
    <script src="/assets/js/modernizr.custom.15390.js"" type="text/javascript"></script><!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-G-ZRGHXLDL9E', 'auto');
ga('send', 'pageview');

</script>
</head>
<body> <div class="header ">
     <div class="container">
         <h1 class="logo"><a href="/">Go deep</a></h1>
         <nav class="nav-collapse">
             <ul class="noList"><li class="elementfirst">
                     <a href="/index.html">Home</a>
                 </li><li class="element">
                     <a href="/articles">Articles (English)</a>
                 </li><li class="element">
                     <a href="/articles-zh">Articles (中文)</a>
                 </li><li class="element">
                     <a href="/articles-jp">Articles (日本語)</a>
                 </li><li class="element">
                     <a href="/categories">Categories</a>
                 </li><li class="element">
                     <a href="/contact">Contact</a>
                 </li><li class="elementlast">
                     <a href="/about">About</a>
                 </li><li> <a href="https://github.com/gabirel" target="_blank">GitHub</a></li>
             </ul>
         </nav>
     </div>
 </div><!-- end .header -->
<div class="content">
      <div class="container">
         <article class="post"><header>
    <h1 class="postTitle">Constrain Struct Generic Field in Rust</h1>
    
    <p class="meta">May 19, 2022 | <span class="time">14</span> Minutes Read</p>
    
  </header>

  <p class="intro"><span class="dropcap">I</span>t is a quite common need to constrain struct generic field to certain types in Rust. We usually have two different ways to implement this. Trait or dispatching each of them by ourselves.</p>

<p>In this post, I am going to show you how to implement this. Therefore, this post should be meant for the “beginners”. This post is gonna show you from the basic to the final working version.</p>

<p>It is recommended to read the most fundamental basics from <a href="https://dev.to/talzvon/rust-generic-types-in-method-definitions-4iah">this article</a>.
First part of codes are based on it.</p>

<hr />
<p>Table of Contents</p>

<ul id="markdown-toc">
  <li><a href="#demands" id="markdown-toc-demands">Demands</a></li>
  <li><a href="#two-ways-to-constrain" id="markdown-toc-two-ways-to-constrain">Two ways to constrain</a>    <ul>
      <li><a href="#dispatching" id="markdown-toc-dispatching">Dispatching</a>        <ul>
          <li><a href="#original" id="markdown-toc-original">Original</a></li>
          <li><a href="#modification" id="markdown-toc-modification">Modification</a></li>
          <li><a href="#one-more-step-remove-deuplication" id="markdown-toc-one-more-step-remove-deuplication">One More Step: Remove Deuplication</a></li>
        </ul>
      </li>
      <li><a href="#trait--bounds" id="markdown-toc-trait--bounds">Trait &amp; Bounds</a>        <ul>
          <li><a href="#one-more-struct-implementation-with-trait" id="markdown-toc-one-more-struct-implementation-with-trait">One More: Struct Implementation with Trait</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="demands">Demands</h2>

<p>We need a struct which has some fields with generics,
but we need some restrictions as well.</p>

<p>Let’s call it by <code class="language-plaintext highlighter-rouge">Container</code>, which contains something.
But we don’t know what type it is, so generics are necessary.</p>

<p>First, in the form of code, we define struct like this:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Second, we would like to constrain types to certain types,
like integer, float or custom structs.</p>

<p>Let’s name a custom struct, call <code class="language-plaintext highlighter-rouge">Color</code>.</p>

<p>Therefore, for exmaple, <code class="language-plaintext highlighter-rouge">T</code> can only be <code class="language-plaintext highlighter-rouge">i32</code>, <code class="language-plaintext highlighter-rouge">f64</code> and <code class="language-plaintext highlighter-rouge">Color</code>.
<strong>Nothing else.</strong></p>

<p>Rust compiler now knows the specific forms of <code class="language-plaintext highlighter-rouge">Container</code>,
which will <a href="https://doc.rust-lang.org/book/ch10-01-syntax.html">expand codes into detailed ones</a>.</p>

<h2 id="two-ways-to-constrain">Two ways to constrain</h2>

<h3 id="dispatching">Dispatching</h3>

<h4 id="original">Original</h4>

<p>From <a href="https://dev.to/talzvon/rust-generic-types-in-method-definitions-4iah">this article</a>, you get these codes:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="n">red</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">green</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">blue</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"I exist"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">inst1</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">Color</span> <span class="p">{</span> <span class="n">red</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">30</span> <span class="p">},</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst2</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst3</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mf">12.2</span> <span class="p">};</span>

    <span class="n">inst1</span><span class="nf">.foo</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst2</span><span class="nf">.foo</span><span class="p">();</span> <span class="c1">// Won't work - method doesn't exist</span>
    <span class="n">inst3</span><span class="nf">.foo</span><span class="p">();</span> <span class="c1">// Won't work - method doesn't exist</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you know some very basic knowledge about generics,
you should know what it is doing.</p>

<p>Anyway, short explanation: Only <code class="language-plaintext highlighter-rouge">Color</code> container works
because it has its own implementation for <code class="language-plaintext highlighter-rouge">Color</code> container only.
Integer type or float type won’t work due to empty of implementation.</p>

<p>So, it gets what we want. Some constraints on generic types.</p>

<h4 id="modification">Modification</h4>

<p>Let’s modify codes to make it more elaborate for future purpose.</p>

<p>Print some details to make it look like workable and provable.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="n">red</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">green</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">blue</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.field</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Container</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.field</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Container</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.field</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">fun</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">inst1</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">Color</span> <span class="p">{</span>
            <span class="n">red</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">green</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="n">blue</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst2</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst3</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mf">12.2</span> <span class="p">};</span>

    <span class="n">inst1</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst2</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst3</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, we need to dispatch
three types manually in order to make this work.
Three times duplication as well.</p>

<p>But it will work anyway. Its output:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Color <span class="o">{</span> red: 10, green: 20, blue: 30 <span class="o">}</span>
10
12.2
</code></pre></div></div>

<p><strong>Try to comment out implementation for <code class="language-plaintext highlighter-rouge">f64</code>. See what it happens.</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error[E0599]: no method named <span class="sb">`</span>print<span class="sb">`</span> found <span class="k">for </span>struct <span class="sb">`</span>Container&lt;<span class="o">{</span>float<span class="o">}&gt;</span><span class="sb">`</span> <span class="k">in </span>the current scope
  <span class="nt">--</span><span class="o">&gt;</span> src/fun_1_basic.rs:43:11
   |
8  | struct Container&lt;T&gt; <span class="o">{</span>
   | <span class="nt">-------------------</span> method <span class="sb">`</span>print<span class="sb">`</span> not found <span class="k">for </span>this
...
43 |     inst3.print<span class="o">()</span><span class="p">;</span> // This will work
   |           ^^^^^ method not found <span class="k">in</span> <span class="sb">`</span>Container&lt;<span class="o">{</span>float<span class="o">}&gt;</span><span class="sb">`</span>
   |
   <span class="o">=</span> note: the method was found <span class="k">for</span>
           - <span class="sb">`</span>Container&lt;Color&gt;<span class="sb">`</span>
           - <span class="sb">`</span>Container&lt;i32&gt;<span class="sb">`</span>

For more information about this error, try <span class="sb">`</span>rustc <span class="nt">--explain</span> E0599<span class="sb">`</span><span class="nb">.</span>
</code></pre></div></div>

<p>Rust compiler complains about <code class="language-plaintext highlighter-rouge">Container&lt;{float}&gt;</code> because we do not implement them.
Therefore, we are only allow to use <code class="language-plaintext highlighter-rouge">Color</code> and <code class="language-plaintext highlighter-rouge">i32</code> type.</p>

<h4 id="one-more-step-remove-deuplication">One More Step: Remove Deuplication</h4>

<p>The problem is that we still needs to duplicate exact codes for 3 times.
We can remove that duplication by just implementing for all types.
(Yes, we do not consider restrictions for now. Deal with it later.)</p>

<p>Check codes:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Debug</span><span class="p">;</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="n">red</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">green</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">blue</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// `Debug` to set bounds for generics</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">Debug</span><span class="o">&gt;</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.field</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">fun</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">inst1</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">Color</span> <span class="p">{</span>
            <span class="n">red</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">green</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="n">blue</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst2</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst3</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mf">12.2</span> <span class="p">};</span>

    <span class="n">inst1</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst2</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst3</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We just implement for all types by using <code class="language-plaintext highlighter-rouge">impl&lt;T: Debug&gt; Container&lt;T&gt; { }</code>.
Therefore, rust compiler will know expand codes automatically by using <code class="language-plaintext highlighter-rouge">impl&lt;T&gt;</code>.</p>

<h3 id="trait--bounds">Trait &amp; Bounds</h3>

<p>However, in previous section we cannot set constraints on generic type
just for convenience.</p>

<p>There is a solution for this. <strong>Traits and bounds.</strong></p>

<p><a href="https://doc.rust-lang.org/book/ch10-02-traits.html">The Book</a> says
traits can be used to define shared behaviors in an abstract way.
The examples from <a href="https://doc.rust-lang.org/book">The Book</a> can
demonstrate how it works precisely.
(<code class="language-plaintext highlighter-rouge">NewsArticle</code> and <code class="language-plaintext highlighter-rouge">Tweet</code> can share the same behavior,
which is <code class="language-plaintext highlighter-rouge">summary</code> from <code class="language-plaintext highlighter-rouge">Summary</code> trait.)</p>

<p>However, it can also be used for dispatching,
which is already a common sense for veterans. In the following secions,
you may learn it from some demos.</p>

<ol>
  <li>
    <p><strong>Make constraints</strong></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">ContainerTrait</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>All types must follow constraints, which is called <code class="language-plaintext highlighter-rouge">ContainerTrait</code>.</p>
  </li>
  <li>
    <p><strong>Define Trait/Boundary</strong></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// you can alow use empty trait only</span>
<span class="c1">// `foo` is used to show some details</span>
<span class="k">trait</span> <span class="n">ContainerTrait</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Define what boundary it is</strong></p>

    <p>Explanation: Traits act like the void, which is nothing there.
Rust compiler would never know when it is the void, right?
So, we need to add some actual stuff in that “void” trait for the compiler.</p>

    <p>Let’s add then.</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Color -&gt; {:?}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.red -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.red</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.green -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.green</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.blue -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.blue</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
   
<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"i32 -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
   
<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="nb">f64</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"f64 -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>So, other types does not satisfy the bound <code class="language-plaintext highlighter-rouge">ContainerTrait</code>, such as <code class="language-plaintext highlighter-rouge">u32</code>.
These are basic constraints for that trait.</p>
  </li>
  <li>
    <p><strong>Full picture</strong></p>

    <p>That’s it. Let’s see the big picture and check whether it works or not.</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Debug</span><span class="p">;</span>
       
<span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="n">red</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">green</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">blue</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
<span class="p">}</span>
       
<span class="k">trait</span> <span class="n">ContainerTrait</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">);</span>
<span class="p">}</span>
       
<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Color -&gt; {:?}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.red -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.red</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.green -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.green</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.blue -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.blue</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
       
<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"i32 -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
       
<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="nb">f64</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"f64 -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
       
<span class="k">struct</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">ContainerTrait</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>
       
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">fun</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">inst1</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">Color</span> <span class="p">{</span>
            <span class="n">red</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">green</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="n">blue</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst2</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst3</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mf">12.2</span> <span class="p">};</span>
       
    <span class="n">inst1</span><span class="py">.field</span><span class="nf">.foo</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst2</span><span class="py">.field</span><span class="nf">.foo</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst3</span><span class="py">.field</span><span class="nf">.foo</span><span class="p">();</span> <span class="c1">// This will work</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>It still works:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Color <span class="o">{</span> red: 10, green: 20, blue: 30 <span class="o">}</span>
10
12.2
</code></pre></div>    </div>

    <p>If we comment out the implementation for <code class="language-plaintext highlighter-rouge">f64</code>, check the compiler:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error[E0277]: the trait bound <span class="sb">`</span><span class="o">{</span>float<span class="o">}</span>: ContainerTrait<span class="sb">`</span> is not satisfied
  <span class="nt">--</span><span class="o">&gt;</span> src/fun_3_trait.rs:48:17
   |
48 |     <span class="nb">let </span>inst3 <span class="o">=</span> Container <span class="o">{</span> field: 12.2 <span class="o">}</span><span class="p">;</span>
   |                 ^^^^^^^^^ the trait <span class="sb">`</span>ContainerTrait<span class="sb">`</span> is not implemented <span class="k">for</span> <span class="sb">`</span><span class="o">{</span>float<span class="o">}</span><span class="sb">`</span>
   |
   <span class="o">=</span> <span class="nb">help</span>: the following implementations were found:
             &lt;Color as ContainerTrait&gt;
             &lt;i32 as ContainerTrait&gt;
note: required by a bound <span class="k">in</span> <span class="sb">`</span>Container<span class="sb">`</span>
  <span class="nt">--</span><span class="o">&gt;</span> src/fun_3_trait.rs:35:21
   |
35 | struct Container&lt;T: ContainerTrait&gt; <span class="o">{</span>
   |                     ^^^^^^^^^^^^^^ required by this bound <span class="k">in</span> <span class="sb">`</span>Container<span class="sb">`</span>
   
error[E0689]: can<span class="s1">'t call method `foo` on ambiguous numeric type `{float}`
  --&gt; src/fun_3_trait.rs:52:17
   |
52 |     inst3.field.foo(); // Won'</span>t work - <span class="s2">"the trait </span><span class="sb">`</span>ContainerTrait<span class="sb">`</span><span class="s2"> is not implemented for </span><span class="sb">`</span><span class="o">{</span>float<span class="o">}</span><span class="sb">`</span><span class="s2">"</span>
   |                 ^^^
   
Some errors have detailed explanations: E0277, E0689.
For more information about an error, try <span class="sb">`</span>rustc <span class="nt">--explain</span> E0277<span class="sb">`</span><span class="nb">.</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Rust compiler says no implementation for <code class="language-plaintext highlighter-rouge">{float}</code>. That’s it. Constraints!</p>

<h4 id="one-more-struct-implementation-with-trait">One More: Struct Implementation with Trait</h4>

<p>One more step: define implementation for that struct for usable demo.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Debug</span><span class="p">;</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="n">red</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">green</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">blue</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">trait</span> <span class="n">ContainerTrait</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Color -&gt; {:?}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.red -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.red</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.green -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.green</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Color.blue -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.blue</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"i32 -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">ContainerTrait</span> <span class="k">for</span> <span class="nb">f64</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"f64 -&gt; {}"</span><span class="p">,</span> <span class="k">self</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">ContainerTrait</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// New here</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">ContainerTrait</span><span class="o">&gt;</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.field</span><span class="nf">.foo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">fun</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">inst1</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">Color</span> <span class="p">{</span>
            <span class="n">red</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">green</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="n">blue</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst2</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mi">10</span> <span class="p">};</span>
    <span class="k">let</span> <span class="n">inst3</span> <span class="o">=</span> <span class="n">Container</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="mf">12.2</span> <span class="p">};</span>

    <span class="n">inst1</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst2</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
    <span class="n">inst3</span><span class="nf">.print</span><span class="p">();</span> <span class="c1">// This will work</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, the real-life example should be complete.</p>

<p>If you find anything wrong, feel free to <a href="https://godeep.pro/contact/">contact me</a>.</p>

<center><blockquote>The End</blockquote></center>



  <!-- POST NAVIGATION -->
  <footer class="postNav clearfix"><a class="prev" href="/blog/%E4%BC%98%E9%9B%85%E6%B5%8B%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4-Rust-Golang-Python/"><span>&laquo;&nbsp; 优雅测函数执行时间（Rust, Golang, Python）</span></a></footer>
</article>
      </div>
   </div><!-- end .content --><div class="footer">
	<div class="container">
		<p class="copy">
			&copy;2017-2022
					<a href="https://godeep.pro/about">Gabriel Farnsworth</a>.
				Powered by <a href="http://jekyllrb.com">Jekyll</a>.
			Theme by <a href="https://github.com/brianmaierjr/long-haul">Long-haul</a>.<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">Visits: <span id="busuanzi_value_site_pv"></span></span></p>

		<div class="footer-links">
			<ul class="noList"><li>
					<a href="https://github.com/gabirel" target="_blank">
						<svg id="github" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg"
							xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100"
							style="height: 30px; width: 30px;">
							<circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
							<path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)"
								d="M50,1C22.938,1,1,22.938,1,50s21.938,49,49,49s49-21.938,49-49S77.062,1,50,1z M79.099,79.099 c-3.782,3.782-8.184,6.75-13.083,8.823c-1.245,0.526-2.509,0.989-3.79,1.387v-7.344c0-3.86-1.324-6.699-3.972-8.517 c1.659-0.16,3.182-0.383,4.57-0.67c1.388-0.287,2.855-0.702,4.402-1.245c1.547-0.543,2.935-1.189,4.163-1.938 c1.228-0.75,2.409-1.723,3.541-2.919s2.082-2.552,2.847-4.067s1.372-3.334,1.818-5.455c0.446-2.121,0.67-4.458,0.67-7.01 c0-4.945-1.611-9.155-4.833-12.633c1.467-3.828,1.308-7.991-0.478-12.489l-1.197-0.143c-0.829-0.096-2.321,0.255-4.474,1.053 c-2.153,0.798-4.57,2.105-7.249,3.924c-3.797-1.053-7.736-1.579-11.82-1.579c-4.115,0-8.039,0.526-11.772,1.579 c-1.69-1.149-3.294-2.097-4.809-2.847c-1.515-0.75-2.727-1.26-3.637-1.532c-0.909-0.271-1.754-0.439-2.536-0.503 c-0.782-0.064-1.284-0.079-1.507-0.048c-0.223,0.031-0.383,0.064-0.478,0.096c-1.787,4.53-1.946,8.694-0.478,12.489 c-3.222,3.477-4.833,7.688-4.833,12.633c0,2.552,0.223,4.889,0.67,7.01c0.447,2.121,1.053,3.94,1.818,5.455 c0.765,1.515,1.715,2.871,2.847,4.067s2.313,2.169,3.541,2.919c1.228,0.751,2.616,1.396,4.163,1.938 c1.547,0.543,3.014,0.957,4.402,1.245c1.388,0.287,2.911,0.511,4.57,0.67c-2.616,1.787-3.924,4.626-3.924,8.517v7.487 c-1.445-0.43-2.869-0.938-4.268-1.53c-4.899-2.073-9.301-5.041-13.083-8.823c-3.782-3.782-6.75-8.184-8.823-13.083 C9.934,60.948,8.847,55.56,8.847,50s1.087-10.948,3.231-16.016c2.073-4.899,5.041-9.301,8.823-13.083s8.184-6.75,13.083-8.823 C39.052,9.934,44.44,8.847,50,8.847s10.948,1.087,16.016,3.231c4.9,2.073,9.301,5.041,13.083,8.823 c3.782,3.782,6.75,8.184,8.823,13.083c2.143,5.069,3.23,10.457,3.23,16.016s-1.087,10.948-3.231,16.016 C85.848,70.915,82.88,75.317,79.099,79.099L79.099,79.099z">
							</path>
						</svg>
					</a>
				</li><li>
					<a href="mailto:godeeppro@pm.me" target="_blank">
						<svg id="mail" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg"
							xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100"
							style="height: 30px; width: 30px;">
							<circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
							<path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)"
								d="M50,1C22.938,1,1,22.938,1,50s21.938,49,49,49s49-21.938,49-49S77.062,1,50,1z M25.5,25.5h49 c0.874,0,1.723,0.188,2.502,0.542L50,57.544L22.998,26.041C23.777,25.687,24.626,25.499,25.5,25.5L25.5,25.5z M19.375,68.375v-36.75 c0-0.128,0.005-0.256,0.014-0.383l17.96,20.953L19.587,69.958C19.448,69.447,19.376,68.916,19.375,68.375L19.375,68.375z M74.5,74.5 h-49c-0.541,0-1.072-0.073-1.583-0.212l17.429-17.429L50,66.956l8.653-10.096l17.429,17.429C75.572,74.427,75.041,74.5,74.5,74.5 L74.5,74.5z M80.625,68.375c0,0.541-0.073,1.072-0.211,1.583L62.652,52.195l17.96-20.953c0.008,0.127,0.014,0.255,0.014,0.383 L80.625,68.375L80.625,68.375z">
							</path>
						</svg>
					</a>
				</li></ul>
		</div>
	</div>
</div>
<!-- end .footer --><!-- Add jQuery and other scripts -->
<!-- seems to no need to load jquery from network -->
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
<script>window.jQuery || document.write('<script src="/assets/js/jquery-1.11.2.min.js"><\/script>')</script>
<script src="/assets/js/dropcap.min.js"></script>
<script src="/assets/js/responsive-nav.min.js"></script>
<script src="/assets/js/scripts.js"></script>
</body>

</html>
